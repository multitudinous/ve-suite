###############################################################
##Builds Persistence Example
#!python
import os, sys, string, glob
pj = os.path.join
import SConsAddons.Util as sca_util
Import('baseEnv ves_pkg LIBDIR RootDir buildDir GetPlatform')
Import('poco_options boost_options' )

MONGO_DRIVER_PATH = GetOption('mongodriverpath')
print "******* mdp = ",MONGO_DRIVER_PATH

openDir = os.path.abspath( pj(RootDir, 'external', 'Persistence','src','examples') )
buildSrcDir = pj('#',buildDir,'external','Persistence','src','examples')

lib_env = ves_pkg.getEnv().Clone()

headers = sca_util.getHeadersRecursive( openDir )
sources = sca_util.getSourcesRecursive( openDir )

headers = map(lambda s: s, 
                headers)
sources = map(lambda s: s, 
                sources)

lib_env.Append( LIBS = [ 'Persistence' ] )
lib_env.Append(LIBPATH = [  pj('#',buildDir,'external','Persistence')] )

lib_env.Append( CPPPATH = [pj('#',buildDir,'external','Persistence','src')] )
#lib_env.Append( CPPPATH = ['/home/penn/fire/dev/deps/mongo-cxx-driver-v2.0'] )
lib_env.Append( CPPPATH = [MONGO_DRIVER_PATH] )
                        
poco_options.apply( lib_env )
boost_options.apply( lib_env )

if GetPlatform() == 'linux':
    lib_env.Append( CCFLAGS=['-fPIC'])

prog = ves_pkg.createProgram('PersistenceTest' + lib_env["PROGSUFFIX"], lib_env, 'bin')
prog.addSources(sources)
prog.build()
