##Builds loki
import os, sys, string
pj = os.path.join
import SConsAddons.Util as sca_util

Import('baseEnv ves_pkg LIBDIR RootDir buildDir osg_options GetPlatform')
openDir = os.path.abspath( pj(RootDir, 'external', 'osgEphemeris') )
headers = sca_util. getFilesRecursiveByExt( pj( openDir, 'include','osgEphemeris'),['*']  )
sources = sca_util.getSourcesRecursive( pj( openDir, 'src', 'osgEphemerisLib' ) )
headers = map(lambda s: pj('include','osgEphemeris', s), 
                headers)
sources = map(lambda s: pj('src', 'osgEphemerisLib', s), 
                sources)

lib_env = ves_pkg.getEnv().Copy()
lib_env.Append( CPPPATH = [pj(openDir, 'include' )] )
lib_env.Append( CPPDEFINES  = ['OSGEPHEMERIS_LIBRARY'] )

if GetPlatform() == 'darwin':
    lib_env.Append( CPPDEFINES  = ['_DARWIN'] )
    lib_env.Append( LINKFLAGS  = ['-framework','OpenGL'] )

osg_options.apply( lib_env )

if baseEnv['StaticLibs'] == "yes":
    lib = ves_pkg.createStaticAndSharedLibrary('osgEphemeris', lib_env,
                                               installPrefix = LIBDIR)
else:
    lib = ves_pkg.createSharedLibrary('osgEphemeris', lib_env,
                                      installPrefix = LIBDIR)
   
lib.addSources(sources)
lib.addHeaders(headers, '..' )
lib.build()

