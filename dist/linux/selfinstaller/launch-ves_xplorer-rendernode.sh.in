#!/bin/bash

source __VE_SUITE_ENV_FILE_PLACEHOLDER__

function usage()
{
    echo "Usage: $0 [ -p <listen port> ] [ -d ] [ -h ]"
    echo ""
    echo "  Options"
    echo ""
    echo "  -p : specify the VR Juggler listening port (optional)"
    echo "  -d : enable desktop cluster control mode"
    echo "  -h : show this help info"
}

LISTEN_PORT=""
DESKTOP_CLUSTER_CONTROL="no"

while getopts "p:dh" OPT
do
    case ${OPT} in
        p)
            LISTEN_PORT=${OPTARG}
            ;;
        d)
            DESKTOP_CLUSTER_CONTROL="yes"
            ;;
        h)
            usage
            exit 0
            ;;
        ?)
            usage
            exit 1
            ;;
    esac
done


export DISPLAY=:0
HOSTNAME=`hostname`

if [ -z $VES_LOG_LEVEL ]
then
    export VES_LOG_LEVEL=warning
fi

EXTRA_ARGS=""

if [ "${DESKTOP_CLUSTER_CONTROL}" = "yes" ]
then
    EXTRA_ARGS="--DesktopClusterControl"
fi

if [ -z "${LISTEN_PORT}" ]
then
    ves_xplorer --vrjslave --VESRTT --VESLog=$VES_LOG_LEVEL --VESLogPath="${VES_PREFIX}"/debug."${HOSTNAME}".log ${EXTRA_ARGS}
else
    ves_xplorer --vrjslave --listen_port=${LISTEN_PORT} --VESRTT --VESLog=$VES_LOG_LEVEL --VESLogPath="${VES_PREFIX}"/debug."${HOSTNAME}".log ${EXTRA_ARGS}
fi
