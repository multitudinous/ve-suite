<?xml version="1.0" encoding="UTF-8"?>
<chapter id="Visualizations">
  <title>Visualizations</title>

  <para>This chapter describes how to make visualizations using the VE-Suite
  toolkit and a sample dataset. If you want to follow this example, download
  and unzip the sample PrISUm car dataset: <ulink
  url="http://www.vesuite.org/download.php?file=71&amp;log=1">PrISUm.zip</ulink>
  (138MB)</para>

  <section id="visualization_setup">
    <title>Setup</title>

    <para>Although visualizations only require a dataset file (which models
    the technical data), you may want to add a geometry file to the scene to
    view the physical object as well. Once you have set the scene, you can use
    visualization to analyze the data. We will use the PrISUm car example from
    the website to show you how to use visualization.</para>

    <para>First, load the geometry file. To do this, open VE-Launcher and set
    the working directory to the project's (PrISUm) folder. Next, open
    VE-Suite in Desktop mode from VE-Launcher. Load the geometry file
    (PrISUmblend.obj), but do not close the CADTree Manager window yet.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/Visualization1.jpg" />
      </imageobject>
    </mediaobject>

    <para>Right-click on the Model_Geometry folder again and choose
    Properties. A CAD Properties window will pop up. This can be used to
    transform the file's dimensions. To fit PrISUm's geometry file with its
    dataset file, you will need to give it the following
    transformation:</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/Visualization2.jpg" />
      </imageobject>
    </mediaobject>

    <para>Once the parameters are entered, close the CAD Properties and
    CADTree Manager window. Next, you will need to load the datasets, the
    primary files for visualization.</para>
  </section>

  <section id="visualization_dataset_setup">
    <title>Datasets</title>

    <para>The dataset contains the technical data about the model, such as
    pressure and airflow. Visualization turns that data into a map for easier
    viewing. You load datasets in a way similar to the geometry config
    file:</para>

    <para>First, right-click on the gray plugin box again. Choose Data Set
    Config.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/Visualization3base.jpg" />
      </imageobject>
    </mediaobject>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/Visualization4a.jpg" />
      </imageobject>
    </mediaobject>

    <para>Click <guibutton>Add Dataset</guibutton> to create a new dataset and
    name it. Then click <emphasis role="bold">Open</emphasis> under DataSet
    Filename and choose your dataset file (in this case, outFile3.vtk). If you
    are just loading the PrISUm dataset, you do not need to load anything
    else, so just click <guibutton>Load</guibutton> to load the dataset and
    exit the window.</para>

    <para>If you need to load more information, you can load files through the
    other fields. The Precomputed Data Directory and Surface Data Directory
    fields take data files created by the VE-Builder preprocessor to speed up
    calculations. The Volumetric Data Directories field takes <link
    linkend="visualization_texture_based">texture-based</link> data
    files.</para>

    <para><emphasis role="bold">Note:</emphasis> VE-Suite expects each type of
    precomputed data to be stored in a separate folder. Storing all of your
    precomputed data in one folder, or storing any of it in the Working
    Directory, will cause problems in your dataset.</para>

    <para>Finally, you may need to transform the dataset to match up with the
    geometry data. The <guibutton>Transform</guibutton> button brings up a
    Transformation window, like the one used to transform the geometry
    data.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/Visualization5.jpg" />
      </imageobject>
    </mediaobject>

    <para>You will not need to adjust the dataset because you adjusted the
    geometry objects to fit it, so close the Transform Input Window.</para>

    <para>Once you are done selecting the dataset files, choose Submit Job
    from the Connection menu to display the PrISUm car. Use the navigation
    pane, the mouse, or the VE-Xplorer-&gt;View-&gt;Frame All command to
    adjust the camera until you get a good view of it.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/visualizationsetup5.jpg" />
      </imageobject>
    </mediaobject>
  </section>

  <section id="visualization_scalar_planes">
    <title>Scalar Planes</title>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/scalarplanes1.jpg" />
      </imageobject>
    </mediaobject>

    <para>Now that the plugin is set up, we can use the Visualization
    interface to show scalar planes like the one pictured above. Visualization
    not only lets you access scalar contours, but vector planes, isosurfaces,
    and more.</para>

    <para>To bring up the Visualization interface, right-click on the plugin
    to access the menu and select Visualization. This window will
    appear:</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/scalarplanes2.jpg" />
      </imageobject>
    </mediaobject>

    <para>Click on the <guibutton>Scalar Contours</guibutton> button (the
    leftmost icon) to bring up the Scalar Contours interface.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/Visualization8.jpg" />
      </imageobject>
    </mediaobject>

    <para>Notice that you can choose the plane's orientation and position. For
    now, set the Direction to Y and the plane's position to 50 and click
    <guibutton>Add Plane</guibutton>. This should appear on your
    screen:</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/scalarplanes4.jpg" />
      </imageobject>
    </mediaobject>

    <para>Once you are done looking at the contour planes, you can remove them
    from the screen by clicking <guibutton>Clear All</guibutton> on the
    Visualization interface. This will clear any Visualization features from
    VE-Xplorer.</para>
  </section>

  <section id="visualization_vector_planes">
    <title>Vector Planes</title>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/vectorplanes1.jpg" />
      </imageobject>
    </mediaobject>

    <para>Showing vector planes is almost exactly like showing scalar planes.
    First, open up the Visualization interface again by right-clicking on the
    plugin and selecting Visualization.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/vectorplanes2.jpg" />
      </imageobject>
    </mediaobject>

    <para>This time, click on the <guibutton>Vector</guibutton> button (the
    2nd-to-left icon) to open the Vector Contour window.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/vectorplanes3.jpg" />
      </imageobject>
    </mediaobject>

    <para>The Vector Contour window is very similar to the Scalar Contour
    window. This time, set the Direction to Z and the plane's position to 20
    and click <guibutton>Add Plane</guibutton>. This should appear on your
    screen:</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/vectorplanes4.jpg" />
      </imageobject>
    </mediaobject>

    <para>Just like the scalar plane, you can remove the vector plane by
    clicking <guibutton>Clear All</guibutton> on the Visualization
    interface.</para>
  </section>

  <section id="visualization_isosurfaces">
    <title>Isosurfaces</title>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/isosurfaces1.jpg" />
      </imageobject>
    </mediaobject>

    <para>To generate an isosurface, go back to the Visualization interface
    (right-click on the plugin, select Visualization).</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/isosurfaces2.jpg" />
      </imageobject>
    </mediaobject>

    <para>Before you can open the Isosurfaces window, you will also need to
    choose a scalar or vector file. Choose scalars under Scalars and click the
    <guibutton>Isosurfaces</guibutton> button (the 3rd-from-right icon) to
    open the Isosurfaces window.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/isosurfaces3.jpg" />
      </imageobject>
    </mediaobject>

    <para>The Isosurfaces window only has one setting. Set the Isosurface
    pressure to 50 and click <guibutton>Compute Isosurface</guibutton>. This
    should appear on your screen:</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/isosurfaces4.jpg" />
      </imageobject>
    </mediaobject>

    <para>Exit Visualization and examine the isosurface by using the mouse or
    the Navigation pane. Once you are done, reenter Visualization and click
    <guibutton>Clear All</guibutton>.</para>
  </section>

  <section id="visualization_texture_based">
    <title>Texture-Based Datasets</title>

    <para>Texture-based datasets render three-dimensional data without relying
    on primitive shapes. You can view texture-based data in the Visualization
    interface. Then click the Texture Based button on the top icon bar.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/texturebasedmenu.jpg" />
      </imageobject>
    </mediaobject>

    <para>You will get the Texture-Based Tools window. Select the Scalars icon
    to bring up the Scalar Tools window.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/scalartoolswindow.jpg" />
      </imageobject>
    </mediaobject>

    <para>Right now, the screen should be blank, even though you just had a
    contour plane up. Once you select a scalar, its texture-based image should
    appear on your viewscreen. You can adjust the scalar range shown to see
    certain parts of it.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/texturescalarrange.jpg" />
      </imageobject>
    </mediaobject>

    <para>You can also Enable Isosurface to select a specific isosurface
    within the scalar range. (The Advanced Isosurface button is currently
    disabled.)</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/textureisosurface.gif" />
      </imageobject>
    </mediaobject>

    <para>If you have time-step data, you can control its movement through the
    Transient button on the Texture-Based Tools window. From the Transient
    Controls window, you can:</para>

    <itemizedlist>
      <listitem>
        <para><emphasis role="bold">Stop</emphasis> the time steps, resetting
        the data.</para>
      </listitem>

      <listitem>
        <para><emphasis role="bold">Play</emphasis> the time steps.</para>
      </listitem>

      <listitem>
        <para>Go <emphasis role="bold">Forward/Backward</emphasis> one
        frame.</para>
      </listitem>
    </itemizedlist>

    <para><emphasis role="italic">Dataset in images provided courtesy of
    National Energy Technology Laboratory, 2005.</emphasis></para>
  </section>

  <section id="visualization_polydata">
    <title>Polydata Surfaces</title>

    <para>Polydata surfaces let you view technical data on the surface of
    objects, similar to isosurfaces.</para>

    <para>You can use the makeVTKSurface program under VE's Builder Tools to
    build a polydata surface. Run a Builder Shell from VE-Launcher (<ulink
    url="chapter_2_launcher.xml">see Chapter 2</ulink>) and run
    makeVTKSurface. This will build a polydata file from the .vt* file you
    enter. Input your options and wait for the preview window to pop up. When
    you hit E to exit the preview, your polydata file will be created (usually
    as outFile.vtk).</para>

    <para>Start VE-Suite. When you go into the Data Set Config window to load
    the datasets, open the Surface Data Directory option and select the
    polydata file you just made to select it and its directory.</para>

    <para>Submit the job and start Visualization. Pull down the Data Set
    Chooser and select the polydata file, then select the scalar and vector
    you want to use for the Polydata. Click the Polydata button on the far
    right of the button menu to bring up the Polydata menu.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/polydatamenu.jpg" />
      </imageobject>
    </mediaobject>

    <para>Once the Polydata window is up, click Update to display the
    surface.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/polydataregular.jpg" />
      </imageobject>
    </mediaobject>

    <para>You can also choose to Warp the Surface, which stretches the surface
    based on its data values, similar to elevating a contour map to see how
    the terrain looks in three dimensions. Toggle the Scale Factor to choose
    how much the surface is stretched.</para>

    <mediaobject>
      <imageobject>
        <imagedata fileref="../veimages/polydatawarped.jpg" />
      </imageobject>
    </mediaobject>

    <para>Finally, the Advanced button lets you choose which scalar to use to
    color it, just like in the Isosurfaces window.</para>
  </section>

  <section id="Converting_from_Fluent_to_VTU">
    <title>Converting from Fluent (.cas) to VTU</title>

    <para>You will need to write out a .cas file for the post-processed data
    from Fluent. Place it into your working directory. Open a Builder Shell
    from VE-Launcher. Be sure to set the working directory to the .cas file's
    directory. You can then convert the fluent output file to a VTU file with
    this command:</para>

    <para><code>loaderToVtkd -singleFile [CAS filename] -o [working directory]
    -outFileName [name of output filename] -loader cas -w file</code></para>
  </section>
</chapter>