<?xml version="1.0" encoding="UTF-8"?>
<chapter version="5.0" xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml"
         xmlns:db="http://docbook.org/ns/docbook">
  <title>Visualizations</title>

  <para>This chapter describes how to make visualizations using the VE-Suite
  toolkit and a sample dataset. To follow this example, download and unzip the
  PrISUm car dataset: <code><link
  xlink:href="http://www.vesuite.org/external/data/PrISUm.zip">PrISUm.zip</link></code>
  (57MB).</para>

  <section>
    <title>Setup</title>

    <para>Although visualizations only require a dataset file (which models
    the technical data), users may want to add a geometry file to the scene to
    view the physical object as well. Once the scene is set, visualization can
    be used to analyze the data. This chapter uses the PrISUm car example to
    demonstrate visualization.</para>

    <para>Load the geometry file. To do this, open VE-Launcher and set the
    Working Directory to the project's <code>PrISUm</code> directory. Next,
    use VE-Launcher to open VE-Suite in Desktop Mode. Load the geometry file,
    <code>PrISUmblend.obj</code>.</para>

    <para>Keep the CADTree Manager open. Right-click on the Model_Geometry
    directory and choose Properties. A CAD Properties window will open. This
    can be used to transform the file's dimensions. To fit PrISUm's geometry
    file with its dataset file, set the following values in the Transform
    tab:</para>

    <figure>
      <title>Transform the geometry file's dimensions</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/04-CADProperties.png"></imagedata>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Once the parameters are entered, close the CAD Properties and
    CADTree Manager window. Next, you will need to load the datasets, the
    primary files for visualization.</para>
  </section>

  <section>
    <title>Datasets</title>

    <para>The dataset contains the technical data about the model, such as
    pressure and airflow. Visualization turns that data into a map for easier
    viewing. Datasets are loaded similar to the geometry configuration
    file.</para>

    <para>This figure shows the dialog box for loading datasets:</para>

    <figure>
      <title>Selecting a dataset</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/04-datasets-dialog.png"></imagedata>
        </imageobject>
      </mediaobject>
    </figure>

    <para>The following matrix outlines which filetypes are required for each
    type of dataset:</para>

    <table>
      <title>Required filetypes</title>

      <tgroup cols="3">
        <tbody>
          <row>
            <entry>Filetype</entry>

            <entry>Required files, column A</entry>

            <entry>Required files, column B</entry>
          </row>

          <row>
            <entry>VTK</entry>

            <entry></entry>

            <entry></entry>
          </row>

          <row>
            <entry>StarCD</entry>

            <entry>*.param</entry>

            <entry>*.cel, *.vrt, *.usr</entry>
          </row>

          <row>
            <entry>EnSight</entry>

            <entry>*.case</entry>

            <entry>*.flo, variable name</entry>
          </row>

          <row>
            <entry>MFIX</entry>

            <entry>*.mfix</entry>

            <entry></entry>
          </row>

          <row>
            <entry>Fluent</entry>

            <entry>*.cas</entry>

            <entry>*.dat</entry>
          </row>

          <row>
            <entry>AVS</entry>

            <entry>*.avs</entry>

            <entry></entry>
          </row>

          <row>
            <entry>Dicom</entry>

            <entry>*.dcm</entry>

            <entry></entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <para>The required files in column A reference the required files in
    column B. All files in columns A and B are required for loading the
    filetype in that row.</para>

    <para>To load a dataset in VE-Suite, right-click on the gray plugin box
    and click on Data Set Config.</para>

    <figure>
      <title>Loading a dataset in VE-Suite</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/04-datsetconfig-01.png"></imagedata>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Click Add Dataset to create a new dataset and name it, then click
    Open under DataSet Filename and choose your dataset file (in this case,
    <code>prisum.vtk</code>). If you are just loading the PrISUm dataset,
    nothing else needs to be loaded, so click OK to load the dataset.</para>

    <figure>
      <title>Dataset loader</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/VisDataSetLoader.png"></imagedata>
        </imageobject>
      </mediaobject>
    </figure>

    <para>If you need to load more information, you can do so through other
    fields. The Precomputed Data Directory and Surface Data Directory fields
    take data files created by the VE-Builder preprocessor to speed up
    calculations. The Volumetric Data Directories field takes texture-based
    data files.</para>

    <para><emphasis role="bold">NOTE:</emphasis> VE-Suite expects each type of
    precomputed data to be stored in a separate folder. Storing all of the
    precomputed data in one folder, or storing any of it in the Working
    Directory, will cause problems in the dataset.</para>

    <para>Finally, the dataset may need to be transformed to match up with the
    geometry data. The Transform button brings up a Transformation window,
    like the one used to transform the geometry data.</para>

    <figure>
      <title>Transforming the dataset</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/04-CADProperties.png"></imagedata>
        </imageobject>
      </mediaobject>
    </figure>

    <para>The dataset does not need to be adjusted because the geometry
    objects were adjusted to fit it, so the Transform Input Window can be
    closed.</para>

    <para>Once the dataset files have been selected, click OK in the
    DataSetLoader window, then choose Submit Job from the Connection menu to
    display the PrISUm car. Use the navigation pane, the mouse, or the
    VE-Xplorer--&gt;View--&gt;Frame All command to adjust the camera until the
    view is satisfactory.</para>
  </section>

  <section>
    <title>Using Visualizations</title>

    <para>To use visualizations, go to the File menu in VE-Conductor, click
    Open, and select the appropriate .ves file. In this case, we will use
    <code>prisum.ves</code>. You might need to clear the design space by
    clicking on the New button in VE-Conductor.</para>

    <para><emphasis role="bold">NOTE:</emphasis> Make sure to save your work
    before clearning the design space.</para>

    <section>
      <title>Scalar Planes</title>

      <para>The visualization interface can be used to show scalar planes.
      Visualization not only allows access to scalar contours, but also to
      vector planes, isosurfaces, and more.</para>

      <para>To bring up the visualization interface, right-click on the plugin
      to access the menu and select Visualization. This window will
      appear:</para>

      <figure>
        <title>Visualization interface</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisDefaultPluginBox.png"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>Click on the Scalar Contours button (the leftmost icon) to bring
      up the Scalar Contours interface.</para>

      <figure>
        <title>Click on the Scalar Contours button</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisClickScalarContours.png"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>Notice that the plane's orientation and position can be set from
      this window. For now, set the Direction to Y and the plane's position to
      50 and click Add Plane.</para>

      <figure>
        <title>Set the plane's orientation and position</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisScalarContours02.png"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>This should appear on the screen:</para>

      <figure>
        <title>Contour planes visualization</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisScalarContoursCropped04.png"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>Once you are done looking at the contour planes, they can be
      removed by clicking Clear All on the Visualization interface. This will
      clear any Visualization features from VE-Xplorer.</para>
    </section>

    <section>
      <title>Vector Planes</title>

      <para>Showing vector planes is almost exactly like showing scalar
      planes. First, open the Visualization interface again by right-clicking
      on the plugin and selecting Visualization. This time, click on the
      Vector button (second from the left) top open the Vector Contour
      window.</para>

      <figure>
        <title>Click on the Vectors button</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisVectors.png"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>The Vector Contour window is very similar to the Scalar Contour
      window. This time, set the Direction to z and the plane's position to 20
      and click Add Plane. This should appear on the screen:</para>

      <figure>
        <title>Vectors visualization</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisVectorsCropped02.png"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>As with scalar planes, the vector plane can be removed by clicking
      Clear All on the Visualization interface.</para>
    </section>

    <section>
      <title>Isosurfaces</title>

      <para>To generate an isosurface, go back to the Visualization interface
      (right-click on the plugin and select Visualization). Before the
      Isosurfaces window can be opened, a scalar or vector must be chosen.
      Choose scalars under Scalars and click the Isosurfaces button (third
      from the right) to open the Isosurfaces window.</para>

      <figure>
        <title>Click on the Isosurfaces button</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisIsosurfaces.png"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>The Isosurfaces window has only one setting. Set the Isosurfaces
      pressure to 50 and click the Compute Isosurface button. This should
      appear on your screen:</para>

      <figure>
        <title>Isosurfaces visualization</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisIsosurfacesCropped02.png"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>Exit Visualization and examine the isosurface by using the mouse
      or the Navigation pane. Once you are done, reenter Visualization and
      click Clear All.</para>
    </section>

    <section>
      <title>Texture-Based Datasets</title>

      <para>Texture-based datasets render three-dimensional data without
      relying on primitive shapes. Texture-based data can be viewed in the
      Visualization interface. Click the Texture Based button on the top icon
      bar.</para>

      <figure>
        <title>Click on the Texture Based button</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisTextureBased.png"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>The Texture-Based Tools window will open. Select the Scalars icon
      to open the Scalar Tools window.</para>

      <figure>
        <title>Scalar Tools dialog box</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisScalarToolsWindow01.jpg"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>At this point, the screen should be blank, even though a contour
      plane was just on the screen. Once the user selects a scalar, its
      texture-based image should appear on the viewscreen. The scalar range
      can be adjusted so that certain parts of it are visible.</para>

      <figure>
        <title>Texture-based scalar visualization</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisTextureScalArrange02.jpg"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>The Enable Isosurface box can also be checked to select a specific
      isosurface within a scalar range. <emphasis role="bold">NOTE:</emphasis>
      The Advanced... button is currently disabled.</para>

      <figure>
        <title>A specific isosurface can be selected within a scalar
        range</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VistTxtureIsosurface03.gif"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>If time-step data is available, its movement can be controlled
      using the Transient button in the Texture-Based Tools window. From the
      Transient Controls window, you can:</para>

      <itemizedlist>
        <listitem>
          <para>Play the time steps</para>
        </listitem>

        <listitem>
          <para>Stop the time steps, resetting the data</para>
        </listitem>

        <listitem>
          <para>Go Forward or Backward one frame at a time</para>
        </listitem>
      </itemizedlist>

      <para>For more information on how to create a texture-based dataset, see
      the section Creating Texture-Based Datasets in Chapter 13,
      VE-Builder.</para>

      <para>Dataset in images provided courtesy of the National Energy
      Technology Laboratory, 2005.</para>
    </section>

    <section>
      <title>Polydata Surfaces</title>

      <para>Polydata surfaces allow users to view technical data on the
      surface of objects, similar to isosurfaces.</para>

      <para>To build a polydata surface, use the VTKSurface program under VE's
      Builder Tools. Run a Builder Shell from VE-Launcher (see Chapter 13) and
      run <code>makeVTKSurface</code>. This will build a polydata file from
      the <code>.vt*</code> file you enter. Input your options and wait for
      the preview window to open. To exit the preview, press the E key on your
      keyboard. The polydata will be created, usually as
      <code>outFile.vtk</code>.</para>

      <!-- TODO: add olink for Chapter 13-->

      <para>Start VE-Suite. Navigate into the Data Set Config window to load
      the datasets, then open the Surface Data Directory option and left-click
      the polydata file created in the previous step (usually
      <code>outFile.vtk</code>) to select it and its directory.</para>

      <para>Submit the job and start visualization. Pull down the Data Set
      Chooser menu and select the polydata file, then select the scalar and
      vector to use for the polydata. Click the Polydata button on the far
      right side of the button menu to bring up the polydata menu.</para>

      <figure>
        <title>Click on the Polydata button</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisPolydata.png"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>Once the Polydata window is up, click the Update button to display
      the surface.</para>

      <figure>
        <title>Polydata visualization</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisPolydataregular.jpg"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>Users can also choose to warp the surface, which stretches the
      surface based on its data values, similar to elevating a contour map to
      see how the terrain looks in three dimensions. Toggle the scale factor
      to choose how much the surface is stretched.</para>

      <figure>
        <title>Users can warp the surface based on its data values</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/VisPolydatawarped.jpg"></imagedata>
          </imageobject>
        </mediaobject>
      </figure>

      <para>Finally, the advanced button allows users to choose which scalar
      to use to color it, as in the isosurfaces window.</para>
    </section>
  </section>
</chapter>
